<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil del Alumno</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }

    @keyframes slideIn {
      0% {
        transform: perspective(1000px) rotateY(70deg) translateZ(-300px);
        opacity: 0;
      }

      100% {
        transform: perspective(1000px) rotateY(0deg) translateZ(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      0% {
        transform: perspective(1000px) rotateY(0deg) translateZ(0);
        opacity: 1;
      }

      100% {
        transform: perspective(1000px) rotateY(-70deg) translateZ(-300px);
        opacity: 0;
      }
    }

    /* Estilos para las tarjetas y la animaci√≥n de intercambio */
    .card-container {
      position: relative;
      width: 400px;
      /* Ajusta al ancho de tu tarjeta de perfil */
      height: 600px;
      /* Ajusta a la altura de tu tarjeta de perfil */
      margin: 50px auto;
      perspective: 1000px;
      /* Para la animaci√≥n 3D */
    }

    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      transition: transform 0.8s ease-in-out;
      border-radius: 1rem;
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      display: flex;
      flex-direction: column;
      background-color: white;
    }

    .card-front {
      z-index: 2;
      transform: rotateY(0deg);
    }

    .card-back {
      z-index: 1;
      transform: rotateY(180deg);
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #f0f0f0;
      /* Fondo para la tarjeta del leaderboard */
      padding: 20px;
    }

    .card-container.flipped .card-front {
      transform: rotateY(-180deg);
    }

    .card-container.flipped .card-back {
      transform: rotateY(0deg);
    }
  </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    const API_URL = 'https://server-xi-beige.vercel.app'; // URL de tu backend

    const calculateLevel = (exp) => {
      if (exp >= 10000) return 5;
      if (exp >= 5000) return 4;
      if (exp >= 2000) return 3;
      if (exp >= 500) return 2;
      return 1;
    };

    // Componente para el modal de inicio de sesi√≥n de administrador
    const AdminLoginModal = ({ show, onClose, onAdminLoginSuccess, selectedCareer }) => {
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleLogin = async () => {
        try {
          const response = await fetch(`${API_URL}/admin/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password, career: selectedCareer }),
          });

          const data = await response.json();
          if (response.ok) {
            onAdminLoginSuccess(data.token);
            onClose();
          } else {
            setError(data.error || 'Error de inicio de sesi√≥n');
          }
        } catch (error) {
          console.error('Error al iniciar sesi√≥n de administrador:', error);
          setError('Error de conexi√≥n');
        }
      };

      if (!show) return null;

      return (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-8 rounded-lg shadow-xl w-96">
            <h2 className="text-2xl font-bold mb-4 text-center">Iniciar Sesi√≥n (Admin)</h2>
            {error && <p className="text-red-500 text-center mb-4">{error}</p>}
            <input
              type="text"
              placeholder="Usuario"
              className="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
            />
            <input
              type="password"
              placeholder="Contrase√±a"
              className="w-full p-3 mb-6 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />
            <button
              className="bg-blue-600 text-white px-4 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300 w-full font-semibold"
              onClick={handleLogin}
            >
              Iniciar Sesi√≥n
            </button>
            <button
              className="mt-4 w-full text-sm text-gray-500 hover:underline"
              onClick={onClose}
            >
              Cancelar
            </button>
          </div>
        </div>
      );
    };

    // Componente para el Dashboard del Administrador
    const AdminDashboard = ({ show, onClose, studentsData, updateStudentData, selectedCareer, calculateLevel, onRefreshStudents }) => {
      const [editingStudentId, setEditingStudentId] = useState(null);
      const [formData, setFormData] = useState({
        tareas: '',
        monedas: '',
        asistencias: '',
        exp: '',
        games: ''
      });
      const [filter, setFilter] = useState('');
      const [successMessage, setSuccessMessage] = useState('');
      const [errorMessage, setErrorMessage] = useState('');

      const filteredStudents = studentsData.filter(student =>
        student.id.toString().includes(filter) ||
        student.name.toLowerCase().includes(filter.toLowerCase())
      );

      const handleEditClick = (student) => {
        setEditingStudentId(student.id);
        setFormData({
          tareas: student.tareas,
          monedas: student.monedas,
          asistencias: student.asistencias,
          exp: student.exp,
          games: student.games
        });
      };

      const handleFormChange = (e) => {
        setFormData({
          ...formData,
          [e.target.name]: e.target.value
        });
      };

      const handleSave = async (id) => {
        try {
          const token = localStorage.getItem('adminToken');
          const response = await fetch(`${API_URL}/admin/students/${id}/update`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ ...formData, career: selectedCareer })
          });

          const data = await response.json();
          if (response.ok) {
            setSuccessMessage(data.message);
            setErrorMessage('');
            updateStudentData(id, formData.tareas, formData.monedas, formData.asistencias, formData.exp, formData.games, data.newLevel);
            setEditingStudentId(null);
            onRefreshStudents(); // Refrescar los datos despu√©s de la actualizaci√≥n
          } else {
            setErrorMessage(data.error || 'Error al actualizar');
            setSuccessMessage('');
          }
        } catch (error) {
          console.error('Error al actualizar estudiante:', error);
          setErrorMessage('Error de conexi√≥n al actualizar.');
          setSuccessMessage('');
        }
      };

      const handleAddStudent = async () => {
        const newId = prompt("Ingresa el ID del nuevo alumno:");
        const newName = prompt("Ingresa el nombre del nuevo alumno:");
        if (!newId || !newName) {
          alert("ID y nombre son obligatorios.");
          return;
        }

        try {
          const token = localStorage.getItem('adminToken');
          const response = await fetch(`${API_URL}/admin/add-student`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ id: newId, name: newName, career: selectedCareer })
          });

          const data = await response.json();
          if (response.ok) {
            setSuccessMessage(data.message);
            setErrorMessage('');
            onRefreshStudents(); // Refrescar los datos despu√©s de a√±adir un nuevo estudiante
          } else {
            setErrorMessage(data.error || 'Error al a√±adir alumno');
            setSuccessMessage('');
          }
        } catch (error) {
          console.error('Error al a√±adir estudiante:', error);
          setErrorMessage('Error de conexi√≥n al a√±adir alumno.');
          setSuccessMessage('');
        }
      };

      if (!show) return null;

      return (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <h2 className="text-2xl font-bold mb-4 text-center">Panel de Administraci√≥n - Carrera: {selectedCareer}</h2>
            <div className="flex justify-between items-center mb-4">
              <input
                type="text"
                placeholder="Buscar por ID o Nombre"
                className="p-2 border border-gray-300 rounded-lg w-1/3"
                value={filter}
                onChange={(e) => setFilter(e.target.value)}
              />
              <button
                className="bg-green-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-300 mr-2"
                onClick={handleAddStudent}
              >
                A√±adir Alumno
              </button>
              <button
                className="bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300"
                onClick={onRefreshStudents}
              >
                Actualizar Datos
              </button>
            </div>

            {successMessage && <p className="text-green-600 text-center mb-4">{successMessage}</p>}
            {errorMessage && <p className="text-red-500 text-center mb-4">{errorMessage}</p>}

            <table className="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden">
              <thead className="bg-gray-200">
                <tr>
                  <th className="py-3 px-4 border-b text-left">ID</th>
                  <th className="py-3 px-4 border-b text-left">Nombre</th>
                  <th className="py-3 px-4 border-b text-left">Tareas</th>
                  <th className="py-3 px-4 border-b text-left">Monedas</th>
                  <th className="py-3 px-4 border-b text-left">Asistencias</th>
                  <th className="py-3 px-4 border-b text-left">EXP</th>
                  <th className="py-3 px-4 border-b text-left">Nivel</th>
                  <th className="py-3 px-4 border-b text-left">√öltimo Login</th>
                  <th className="py-3 px-4 border-b text-left">Games</th>
                  <th className="py-3 px-4 border-b text-left">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {filteredStudents.map((student) => (
                  <tr key={student.id} className="hover:bg-gray-50">
                    <td className="py-3 px-4 border-b">{student.id}</td>
                    <td className="py-3 px-4 border-b">{student.name}</td>
                    <td className="py-3 px-4 border-b">
                      {editingStudentId === student.id ? (
                        <input
                          type="number"
                          name="tareas"
                          value={formData.tareas}
                          onChange={handleFormChange}
                          className="w-20 p-1 border rounded"
                        />
                      ) : (
                        student.tareas
                      )}
                    </td>
                    <td className="py-3 px-4 border-b">
                      {editingStudentId === student.id ? (
                        <input
                          type="number"
                          name="monedas"
                          value={formData.monedas}
                          onChange={handleFormChange}
                          className="w-20 p-1 border rounded"
                        />
                      ) : (
                        student.monedas
                      )}
                    </td>
                    <td className="py-3 px-4 border-b">
                      {editingStudentId === student.id ? (
                        <input
                          type="number"
                          name="asistencias"
                          value={formData.asistencias}
                          onChange={handleFormChange}
                          className="w-20 p-1 border rounded"
                        />
                      ) : (
                        student.asistencias
                      )}
                    </td>
                    <td className="py-3 px-4 border-b">
                      {editingStudentId === student.id ? (
                        <input
                          type="number"
                          name="exp"
                          value={formData.exp}
                          onChange={handleFormChange}
                          className="w-20 p-1 border rounded"
                        />
                      ) : (
                        student.exp
                      )}
                    </td>
                    <td className="py-3 px-4 border-b">{calculateLevel(student.exp)}</td>
                    <td className="py-3 px-4 border-b">{student.lastLogin ? new Date(student.lastLogin).toLocaleString() : 'N/A'}</td>
                    <td className="py-3 px-4 border-b">
                      {editingStudentId === student.id ? (
                        <input
                          type="number"
                          name="games"
                          value={formData.games}
                          onChange={handleFormChange}
                          className="w-20 p-1 border rounded"
                        />
                      ) : (
                        student.games
                      )}
                    </td>
                    <td className="py-3 px-4 border-b">
                      {editingStudentId === student.id ? (
                        <button
                          className="bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600"
                          onClick={() => handleSave(student.id)}
                        >
                          Guardar
                        </button>
                      ) : (
                        <button
                          className="bg-yellow-500 text-white px-3 py-1 rounded-md hover:bg-yellow-600"
                          onClick={() => handleEditClick(student)}
                        >
                          Editar
                        </button>
                      )}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
            <button
              className="mt-6 bg-red-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-300 w-full font-semibold"
              onClick={onClose}
            >
              Cerrar Sesi√≥n de Administrador
            </button>
          </div>
        </div>
      );
    };

    // Componente para el Leaderboard
    const Leaderboard = ({ studentsData, calculateLevel }) => {
      // Ordenar estudiantes por EXP en orden descendente
      const sortedStudents = [...studentsData].sort((a, b) => b.exp - a.exp);

      return (
        <div className="p-6">
          <h2 className="text-3xl font-bold mb-6 text-center text-gray-800">Tabla de Posiciones</h2>
          <div className="bg-white rounded-lg shadow-lg overflow-hidden">
            <table className="min-w-full leading-normal">
              <thead>
                <tr className="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                  <th className="py-3 px-6 text-left">Posici√≥n</th>
                  <th className="py-3 px-6 text-left">Nombre</th>
                  <th className="py-3 px-6 text-left">EXP</th>
                  <th className="py-3 px-6 text-left">Nivel</th>
                </tr>
              </thead>
              <tbody className="text-gray-700 text-sm">
                {sortedStudents.map((student, index) => (
                  <tr key={student.id} className="border-b border-gray-200 hover:bg-gray-100">
                    <td className="py-3 px-6 text-left whitespace-nowrap">
                      <div className="flex items-center">
                        <span className="font-bold">{index + 1}</span>
                      </div>
                    </td>
                    <td className="py-3 px-6 text-left">
                      <span>{student.name}</span>
                    </td>
                    <td className="py-3 px-6 text-left">
                      <span>{student.exp}</span>
                    </td>
                    <td className="py-3 px-6 text-left">
                      <span>{calculateLevel(student.exp)}</span>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    };


    const App = () => {
      const [id, setId] = useState('');
      const [studentData, setStudentData] = useState(null);
      const [error, setError] = useState('');
      const [career, setCareer] = useState('');
      const [selectedCareer, setSelectedCareer] = useState(() => {
        // Cargar la carrera del localStorage al inicio
        return localStorage.getItem('selectedCareer') || '';
      });

      const [showLogin, setShowLogin] = useState(true);
      const [showProfile, setShowProfile] = useState(false);
      const [showReset, setShowReset] = useState(false);
      const [resetId, setResetId] = useState('');
      const [resetCode, setResetCode] = useState('');
      const [resetPass, setResetPass] = useState('');
      const [showCodeField, setShowCodeField] = useState(false);
      const [showAdminLoginModal, setShowAdminLoginModal] = useState(false);
      const [showAdminDashboard, setShowAdminDashboard] = useState(false);
      const [adminStudentsData, setAdminStudentsData] = useState([]);
      const [isFlipped, setIsFlipped] = useState(false); // Nuevo estado para la animaci√≥n de las tarjetas

      useEffect(() => {
        // Si ya hay una carrera seleccionada, ir directamente a la pantalla de login/perfil
        if (selectedCareer) {
          setShowLogin(true);
        }
      }, [selectedCareer]);

      const handleCareerSelect = (chosenCareer) => {
        setSelectedCareer(chosenCareer);
        localStorage.setItem('selectedCareer', chosenCareer);
        setShowLogin(true);
      };

      const handleLogin = async () => {
        setError('');
        setStudentData(null);
        try {
          const response = await fetch(`${API_URL}/student/${id}?career=${selectedCareer}`);
          const data = await response.json();
          if (response.ok) {
            setStudentData(data);
            setShowProfile(true);
            setShowLogin(false);
            // Actualizar LAST_LOGIN_DATE y LAST_LOGIN_LEVEL
            await fetch(`${API_URL}/student/${id}/login-update`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ career: selectedCareer, exp: data.exp })
            });
          } else {
            setError(data.error || 'Alumno no encontrado.');
          }
        } catch (error) {
          console.error('Error al obtener datos del alumno:', error);
          setError('Error de conexi√≥n.');
        }
      };

      const handleLogout = () => {
        setStudentData(null);
        setId('');
        setShowProfile(false);
        setShowLogin(true);
        setShowAdminDashboard(false);
        setAdminStudentsData([]);
        setSelectedCareer(''); // Resetea la carrera al cerrar sesi√≥n
        localStorage.removeItem('selectedCareer');
        localStorage.removeItem('adminToken'); // Eliminar token de admin al cerrar sesi√≥n
      };

      const handleRequestResetCode = async () => {
        setError('');
        try {
          const response = await fetch(`${API_URL}/request-password-reset`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: resetId, career: selectedCareer }),
          });
          const data = await response.json();
          if (response.ok) {
            alert(data.message);
            setShowCodeField(true);
          } else {
            setError(data.error || 'Error al solicitar c√≥digo.');
          }
        } catch (error) {
          console.error('Error al solicitar c√≥digo:', error);
          setError('Error de conexi√≥n.');
        }
      };

      const handleUpdatePassword = async () => {
        setError('');
        try {
          const response = await fetch(`${API_URL}/reset-password`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: resetId, code: resetCode, newPassword: resetPass, career: selectedCareer }),
          });
          const data = await response.json();
          if (response.ok) {
            alert(data.message);
            setShowReset(false);
            setShowCodeField(false);
            setResetId('');
            setResetCode('');
            setResetPass('');
          } else {
            setError(data.error || 'Error al actualizar contrase√±a.');
          }
        } catch (error) {
          console.error('Error al actualizar contrase√±a:', error);
          setError('Error de conexi√≥n.');
        }
      };

      const fetchAdminStudentsData = useCallback(async () => {
        const token = localStorage.getItem('adminToken');
        if (!token) {
          setError('No autorizado. Por favor, inicia sesi√≥n como administrador.');
          setShowAdminLoginModal(true); // Redirigir al login si no hay token
          return;
        }
        try {
          const response = await fetch(`${API_URL}/admin/students?career=${selectedCareer}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          const data = await response.json();
          if (response.ok) {
            setAdminStudentsData(data);
          } else {
            setError(data.error || 'Error al cargar datos de estudiantes.');
            // Si el token expira o es inv√°lido, forzar re-login
            if (response.status === 401 || response.status === 403) {
              alert('Tu sesi√≥n ha expirado o es inv√°lida. Por favor, inicia sesi√≥n de nuevo.');
              localStorage.removeItem('adminToken');
              setShowAdminLoginModal(true);
              setShowAdminDashboard(false);
            }
          }
        } catch (error) {
          console.error('Error al obtener datos de estudiantes para admin:', error);
          setError('Error de conexi√≥n al cargar datos de estudiantes.');
        }
      }, [selectedCareer]);

      useEffect(() => {
        if (showAdminDashboard) {
          fetchAdminStudentsData();
        }
      }, [showAdminDashboard, fetchAdminStudentsData]);

      const handleAdminLoginSuccess = (token) => {
        localStorage.setItem('adminToken', token);
        setShowAdminDashboard(true);
        setShowLogin(false); // Ocultar login normal si el admin est√° logueado
        fetchAdminStudentsData();
      };

      const updateStudentDataInAdminDashboard = (id, tareas, monedas, asistencias, exp, games, newLevel) => {
        setAdminStudentsData(prevData =>
          prevData.map(student =>
            student.id === id ? { ...student, tareas, monedas, asistencias, exp, games, last_login_level: newLevel } : student
          )
        );
      };

      const handleCardFlip = () => {
        setIsFlipped(!isFlipped);
      };

      if (!selectedCareer) {
        return (
          <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100">
            <h1 className="text-3xl font-bold mb-8 text-gray-800">Selecciona tu Carrera</h1>
            <div className="flex space-x-4">
              <button
                className="bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300 font-semibold"
                onClick={() => handleCareerSelect('Desarrollo de Software')}
              >
                Desarrollo de Software
              </button>
              <button
                className="bg-green-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-300 font-semibold"
                onClick={() => handleCareerSelect('Dise√±o Gr√°fico')}
              >
                Dise√±o Gr√°fico
              </button>
            </div>
          </div>
        );
      }

      if (showAdminDashboard) {
        return (
          <AdminDashboard
            show={showAdminDashboard}
            onClose={handleLogout}
            studentsData={adminStudentsData}
            updateStudentData={updateStudentDataInAdminDashboard}
            selectedCareer={selectedCareer}
            calculateLevel={calculateLevel}
            onRefreshStudents={fetchAdminStudentsData}
          />
        );
      }

      return (
        <>
          {showLogin && (
            <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-md animate-[slideIn_0.8s_ease-out_forwards]">
              <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Bienvenido</h1>
              <p className="text-center text-gray-600 mb-6">Inicia sesi√≥n para ver tu perfil de alumno</p>
              {error && <p className="text-red-500 text-center mb-4">{error}</p>}
              <input
                type="text"
                placeholder="Introduce tu ID de alumno"
                className="w-full p-4 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
                value={id}
                onChange={(e) => setId(e.target.value)}
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    handleLogin();
                  }
                }}
              />
              <button
                className="bg-blue-600 text-white px-4 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300 w-full font-semibold text-lg"
                onClick={handleLogin}
              >
                Acceder
              </button>
              <div className="flex justify-between items-center mt-6">
                <button
                  className="text-sm text-gray-500 hover:underline transition-colors duration-300"
                  onClick={() => setShowReset(true)}
                >
                  ¬øOlvidaste tu contrase√±a?
                </button>
                <button
                  className="text-sm text-blue-600 hover:underline transition-colors duration-300"
                  onClick={() => setShowAdminLoginModal(true)}
                >
                  Admin Login
                </button>
              </div>
            </div>
          )}

          {showProfile && studentData && (
            <div className="card-container" onClick={handleCardFlip}>
              <div className={`card card-front bg-white p-8 ${isFlipped ? 'flipped' : ''}`}>
                <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Perfil del Alumno</h1>

                <div className="text-center mb-6">
                  <img src="https://via.placeholder.com/150" alt="Avatar del Alumno" className="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-blue-500 shadow-md" />
                  <h2 className="text-2xl font-semibold text-gray-900">{studentData.name}</h2>
                  <p className="text-gray-600">ID: {studentData.id}</p>
                  <p className="text-gray-600">Carrera: {selectedCareer}</p>
                </div>

                <div className="grid grid-cols-2 gap-4 text-lg">
                  <div className="flex items-center bg-blue-100 p-3 rounded-lg shadow-sm">
                    <span className="text-blue-600 mr-2">üìö</span> Tareas: <span className="font-semibold ml-auto">{studentData.tareas}</span>
                  </div>
                  <div className="flex items-center bg-yellow-100 p-3 rounded-lg shadow-sm">
                    <span className="text-yellow-600 mr-2">üí∞</span> Monedas: <span className="font-semibold ml-auto">{studentData.monedas}</span>
                  </div>
                  <div className="flex items-center bg-green-100 p-3 rounded-lg shadow-sm">
                    <span className="text-green-600 mr-2"> ÿ≠ÿ∂Ÿàÿ±</span> Asistencias: <span className="font-semibold ml-auto">{studentData.asistencias}</span>
                  </div>
                  <div className="flex items-center bg-purple-100 p-3 rounded-lg shadow-sm">
                    <span className="text-purple-600 mr-2">‚ú®</span> EXP: <span className="font-semibold ml-auto">{studentData.exp}</span>
                  </div>
                  <div className="flex items-center bg-red-100 p-3 rounded-lg shadow-sm">
                    <span className="text-red-600 mr-2">üéÆ</span> Juegos Jugados: <span className="font-semibold ml-auto">{studentData.games}</span>
                  </div>
                  <div className="flex items-center bg-indigo-100 p-3 rounded-lg shadow-sm">
                    <span className="text-indigo-600 mr-2">üèÜ</span> Nivel: <span className="font-semibold ml-auto">{calculateLevel(studentData.exp)}</span>
                  </div>
                  <div className="flex items-center bg-gray-100 p-3 rounded-lg shadow-sm col-span-2">
                    <span className="text-gray-600 mr-2">‚è∞</span> √öltimo Login: <span className="font-semibold ml-auto">{new Date(studentData.lastLogin).toLocaleString()}</span>
                  </div>
                </div>

                <button
                  className="bg-red-500 text-white px-4 py-3 rounded-lg shadow-lg hover:bg-red-600 transition-all duration-300 w-full mt-8 font-semibold text-lg"
                  onClick={handleLogout}
                >
                  Cerrar Sesi√≥n
                </button>
              </div>

              <div className={`card card-back bg-white p-8 ${isFlipped ? 'flipped' : ''}`}>
                <Leaderboard studentsData={adminStudentsData} calculateLevel={calculateLevel} />
              </div>
            </div>
          )}

          {showReset && (
            <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
              <div className="bg-white p-8 rounded-lg shadow-xl w-96">
                <h2 className="text-2xl font-bold mb-4 text-center">Restablecer Contrase√±a</h2>
                {error && <p className="text-red-500 text-center mb-4">{error}</p>}
                {!showCodeField ? (
                  <>
                    <input
                      type="text"
                      placeholder="Introduce tu ID de alumno"
                      className="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                      value={resetId}
                      onChange={(e) => setResetId(e.target.value)}
                    />
                    <button className="bg-orange-500 text-white px-4 py-3 rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 w-full font-semibold" onClick={handleRequestResetCode}>Solicitar C√≥digo</button>
                  </>
                ) : (
                  <>
                    <input
                      type="text"
                      placeholder="C√≥digo de Verificaci√≥n"
                      className="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                      value={resetCode}
                      onChange={(e) => setResetCode(e.target.value)}
                    />
                    <input
                      type="password"
                      placeholder="Nueva Contrase√±a"
                      className="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                      value={resetPass}
                      onChange={(e) => setResetPass(e.target.value)}
                    />
                    <button className="bg-orange-500 text-white px-4 py-3 rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 w-full mt-2 font-semibold" onClick={handleUpdatePassword}>Actualizar contrase√±a</button>
                  </>
                )}

                <button className="text-sm text-gray-500 hover:underline mt-2 transition-colors duration-300" onClick={() => {
                  setShowReset(false);
                  setShowCodeField(false);
                  setResetId('');
                  setResetCode('');
                  setResetPass('');
                }}>Cancelar</button>
              </div>
            </div>
          )}

          <AdminLoginModal
            show={showAdminLoginModal}
            onClose={() => setShowAdminLoginModal(false)}
            onAdminLoginSuccess={handleAdminLoginSuccess}
            selectedCareer={selectedCareer}
          />

          <AdminDashboard
            show={showAdminDashboard}
            onClose={handleLogout}
            studentsData={adminStudentsData}
            updateStudentData={updateStudentDataInAdminDashboard}
            selectedCareer={selectedCareer}
            calculateLevel={calculateLevel}
            onRefreshStudents={fetchAdminStudentsData}
          />
        </>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>

</html>